@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<main class="main">
    <section class="hero">
        <h2>Read and Share Reviews</h2>
        <p>Explore book reviews by readers like you or add your own insights for others to discover.</p>
        <form>
            <select id="bookDropdown" onchange="filterReviews()">
            <option value="all">Select a book to filter reviews</option>
            @if (ViewBag.BookTitles != null)
            {
                foreach (var title in ViewBag.BookTitles)
                {
                    <option value="@title.BookID">@title.BookTitle</option>
                }
            }
        </select>

        </form>
    </section>

    <section class="reviews-list">
        <h3>Reviews</h3>
        <div id="reviewsContainer">
            <article class="review">
                <h4 id= "reviewBookTitle"></h4>
                <p id="bookReview"></p>
                <button class="review-button">Edit</button>
                <button class="review-button">Delete</button>
            </article>
            
            <!-- Add more dummy reviews as needed -->
        </div>
    </section>


    <section class="add-review">
        <h3>Add a Review</h3>
        <form asp-action="AddReview" method="post">
            <label for="bookToReview">Choose a book:</label>
            <select id="bookToReview" name="bookToReview">
                <option value="The Lord of the Rings">The Lord of the Rings</option>
                <option value="Pride and Prejudice">Pride and Prejudice</option>
                <option value="The Hitchhiker's Guide to the Galaxy">The Hitchhiker's Guide to the Galaxy</option>
                <option value="A Brief History of Time">A Brief History of Time</option>
            </select>
            <textarea name="reviewText" placeholder="Write your review here..."></textarea>
            <button type="submit" class="review-button">Submit Review</button>
        </form>
    </section>
</main>

@section Scripts {
    <script src=
"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
            integrity=
"sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer">
    </script>
    <script type="text/javascript">
   
            $('#bookDropdown').change(function()
            {
                debugger
            
    var bookID =$('#bookDropdown').val(); // Example bookID
    var bookTitle = $("#bookDropdown option:selected").text();
    $.ajax({
        url: '/Review/GetReviewTitleByBookID',  // Update the URL based on your routing setup
        type: 'GET',
        dataType: 'json',
        data: { bookID: bookID },
        success: function(response) {
            if(response.success) {
                $('#bookReview').html(response.reviewTitle);
                $('#reviewBookTitle').html(bookTitle);
            } else {
                alert("No review found for this book.");
            }
        },
        error: function() {
            alert("Error loading review.");
        }
    });
});
        
    </script>
}
